CJW.jfp.widget.Carousel=JFPWClass.extend(CJW.jfp.widget.Object,{className:"CJW.jfp.widget.Carousel",selector:null,instance:null,url:null,templateId:null,jsonRequest:false,initialize:function(c,a,b){c=c||{};a=a||{};b=b||{};this.oCfg={};this.topicConfig={};JFP.cp(this.oCfg,c,{wrapperSet:"__UNK__"});this.selector=this.oCfg.wrapperSet;JFP.cnp(this.oCfg,a);JFP.cnp(this.oCfg,{styleClass:"jcarousel-skin-avatar",wrap:"circular",nextButtonDisabled:false,prevButtonDisabled:false});this.firstTime=true;this._applyCfg();this.setTopics(b);this._create()},_applyCfg:function(){var b=Math.floor(Math.random()*110);if(!this.ulId){this.ulId="UlEl_"+b;this.ulSelector="#"+this.ulId}JFP.cnp(this.oCfg,{eventsTopicName:"/topic/events"});var a=this;var d=function(f,e){if(e!="init"){return}else{if(a.firstTime==false){return}}a._loadCarouselContent()};this._setInternalProperties(this.oCfg);var c=this._wrapCallBack(d,this.oCfg.itemLoadCallback);JFP.cp(this.oCfg,{itemLoadCallback:c})},getProperty:function(a){if(this[a]){return this[a]}return this.instance.options[a]},setProperty:function(b,c){var a={};a[b]=c;this._setInternalProperties(a)},setProperties:function(a){a=a||{};this._setInternalProperties(a)},_setInternalProperties:function(a){if(a.wrapperSet!=undefined){delete a.wrapperSet}if(a.url!=undefined){this.url=a.url;delete a.url}if(a.templateId!=undefined){this.templateId=a.templateId;delete a.templateId}if(a.styleClass!=undefined){this.styleClass=a.styleClass;delete a.styleClass}if(a.eventsTopicName!=undefined){this.eventsTopicName=a.eventsTopicName;delete a.eventsTopicName}if(a.nextButtonDisabled!=undefined){this.nextButtonDisabled=a.nextButtonDisabled;delete a.nextButtonDisabled}if(a.prevButtonDisabled!=undefined){this.prevButtonDisabled=a.prevButtonDisabled;delete a.prevButtonDisabled}if(this.templateId==null){this.templateId="defaultTemplate"}if(this.url!=null&&this.templateId!=null){this.jsonRequest=true}},_create:function(){if(this.instance!=null){return}$jq(this.selector).first().append("<ul id="+this.ulId+' class="'+this.styleClass+'"></ul>');$jq(this.ulSelector).jcarousel(this.oCfg);this.instance=$jq(this.ulSelector).data("jcarousel");this._initEvents();this.triggerPostConstruction()},_loadCarouselContent:function(){if(this.jsonRequest==true){this._loadCarouselJSONContent();this.firstTime=false}},_loadCarouselJSONContent:function(){$jq.ajax({url:this.url,dataType:"json",contentType:"application/x-www-form-urlencoded",type:"POST",wrapper:this,success:this._JSONLoadHandler})},_JSONLoadHandler:function(a,c,b){if(this.wrapper.templateId=="defaultTemplate"){this.wrapper._addDefTmplData(a)}else{this.wrapper._addCustomTmplData(a)}this.wrapper._initEvents()},_addDefTmplData:function(c){var b=[];$jq.each(c.items,function(d,e){b.push({innerHTML:e.innerHTML})});this.instance.options.size=b.length;for(var a=0;a<b.length;a++){this.instance.add(a+1,b[a].innerHTML)}},_addCustomTmplData:function(f){var c=[];var a=this.templateId;$jq.each(f.items,function(e,h){var g=$jq.tmpl(a,[h]);var d=$jq("<div></div>");g.appendTo(d);c.push({innerHTML:g})});this.instance.options.size=c.length;for(var b=0;b<c.length;b++){this.instance.add(b+1,c[b].innerHTML)}},render:function(a){if(this.instance==null){return}if(!a){this._refreshContent()}else{this._renderData(a)}$jq(window).unbind("resize.jcarousel")},_renderData:function(a){if(this.instance==null){return}this._unbindEvents();this.instance.reset();this.firstTime=true;if(this.templateId=="defaultTemplate"){this._addDefTmplData(a)}else{this._addCustomTmplData(a)}this._initEvents();this.firstTime=false},_refreshContent:function(){this.firstTime=true;if(this.instance==null){return}this._unbindEvents();this.instance.reset();this._loadCarouselContent()},_initEvents:function(){if(!this.instance){return}this._unbindEvents();this._bindEvents()},_unbindEvents:function(){if(!this.instance){return}this.instance.buttonNext.unbind(this.instance.options.buttonNextEvent+".jcarousel",this.publishEvent);this.instance.buttonPrev.unbind(this.instance.options.buttonPrevEvent+".jcarousel",this.publishEvent);var d=this.ulSelector+" > .jcarousel-item";var a=$jq(d).length;for(var b=0;b<a;b++){var c=this.instance.get(b);c.unbind("click",this.publishEvent)}},_bindEvents:function(){if(!this.instance){return}var d=this.eventsTopicName;var b=this.selector;var g={topic:d,selector:b};this.instance.buttonNext.bind(this.instance.options.buttonNextEvent+".jcarousel",g,this.publishEvent);this.instance.buttonPrev.bind(this.instance.options.buttonPrevEvent+".jcarousel",g,this.publishEvent);var f=this.ulSelector+" > .jcarousel-item";var a=$jq(f).length;for(var c=0;c<a;c++){var e=this.instance.get(c);e.bind("click",g,this.publishEvent)}},destroy:function(){if(this.ready==false){return}this._destroy$();this._unbindEvents();$jq(this.selector).first().empty();this.instance=null;this.ready=false},disable:function(){$jq(this.selector).first().attr("disabled",true)},enable:function(){$jq(this.selector).first().attr("disabled",false)},widget:function(){return this.instance},isNextButtonDisabled:function(){var a=this.instance.buttonNext.hasClass("jcarousel-next-disabled");return a},isPrevButtonDisabled:function(){var a=this.instance.buttonPrev.hasClass("jcarousel-prev-disabled");return a},getNextButton:function(){return this.instance.buttonNext},disableNextButton:function(){var a=this.isPrevButtonDisabled();this.instance.buttons(false,!a)},enableNextButton:function(){var a=this.isPrevButtonDisabled();this.instance.buttons(true,!a)},getPrevButton:function(){return this.instance.buttonPrev},disablePrevButton:function(){var a=this.isNextButtonDisabled();this.instance.buttons(!a,false)},enablePrevButton:function(){var a=this.isNextButtonDisabled();this.instance.buttons(!a,true)},enableButtons:function(){this.instance.buttons(true,true)},disableButtons:function(){this.instance.buttons(false,false)}});window.$RDY&&$RDY.complete("CJW.jfp.widget.Carousel");