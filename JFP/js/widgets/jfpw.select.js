CJW.jfp.widget.Select=JFPWClass.extend(CJW.jfp.widget.Object,{className:"CJW.jfp.widget.Select",selector:null,instance:null,ready:false,initialize:function(g,d,f){g=g||{};d=d||{};f=f||{};this.oCfg={};this.topicConfig={};JFP.cp(this.oCfg,g,{wrapperSet:"__UNK__"});this.selector=this.oCfg.wrapperSet;JFP.cnp(this.oCfg,d);JFP.cnp(this.oCfg,{styleClass:"jfpw-select",style:"dropdown",format:this.defaultFormatting,templateId:"defaultTemplate",wrapperElement:'<div class="jfw-select-wrapper"/>',roundCorners:false,autocomplete:false});var c=this;this.bigContainerPos=false;var b=function(){var h={};h={top:"0px",left:"0px"};c.list.css(h)};var a=function(){if(!c.list){return}if(c.bigContainerPos==true){c.bigContainer.css("visibility","visible");c.bigContainer.css("display","block");b();$jq(c.listHandleSelector).jfpwidget("refresh");return}var m=c.list.css("top");var l=c.list.css("left");var k=c.list.outerWidth();var n=c.list.outerHeight();var i=c.list.css("z-index");var o={top:m,left:l,width:k+"px",height:n+"px",position:"absolute",border:"1px solid #AAAAAA","background-color":"#ffffff","z-index":i,visibility:"visible",display:"block"};var j=c.list.attr("scrollTop");c.bigContainer.css(o);c.scrollContainer.css({top:"0px",right:"0px",position:"absolute","z-index":i});if($jq.browser.msie==true){c.scrollContainer.css({right:"2px"})}c.list.css({position:"relative","border-style":"none"});b();c.bigContainerPos=true;var h=c.containerFooter1.outerWidth();c.containerFooter2.css({width:function(){return(c.bigContainer.outerWidth()-(h*2))+"px"},left:h+"px"});c.list.attr("scrollTop",j);$jq(c.listHandleSelector).jfpwidget("refresh")};var e=function(){c.bigContainer.css("visibility","hidden");c.bigContainer.css("display","none")};JFP.cp(this.oCfg,{open:this._wrapCallBack(a,this.oCfg.open),close:this._wrapCallBack(e,this.oCfg.close)});this.templateId=this.oCfg.templateId;this.styleClass=this.oCfg.styleClass;this.roundCorners=this.oCfg.roundCorners;delete this.oCfg.styleClass;delete this.oCfg.templateId;delete this.oCfg.roundCorners;this.setTopics(f);this._create()},defaultFormatting:function(c){var a=c.split(",");var b='<span class="ui-selectmenu-item-header">'+a[0]+"</span>";if(a.length>1){b=b+', <span class="ui-selectmenu-item-content">'+a[1]+"</span>"}return b},refresh:function(){if(this.ready==false){return}this.instance.selectmenu("destroy");this.bigContainerPos=false;this.bigContainer.remove();this.scrollContainer.remove();this.instance=null;this.ready=false;this._create()},getProperty:function(a){if(this[a]){return this[a]}return this.instance.selectmenu(a)},setProperty:function(b,c){var a={};a[b]=c;this._setInternalProperties(a)},setProperties:function(a){a=a||{};this._setInternalProperties(a)},_setInternalProperties:function(a){if(a.wrapperSet){delete a.wrapperSet}if(a.styleClass){this.styleClass=a.styleClass;delete a.styleClass}if(a.templateId){this.templateId=a.templateId;if(this.templateId=="null"){this.templateId="defaultTemplate"}delete a.templateId}if(this.ready==true){for(attrName in a){var b=a[attrName];this.instance.selectmenu(attrName,b)}}},_create:function(){if(this.ready==true){return}this.instance=$jq(this.selector).first();this.instance.addClass(this.styleClass);this.instance.removeClass("jfpw-hidden");this.instance.selectmenu(this.oCfg);var c=this.instance.data("selectmenu").list.uid();this.list=c;this.bigContainer=c.parent().uid("big-c");this.bigContainer.addClass("jfpw-select-list-container");if(this.roundCorners){this.bigContainer.addClass("jfpw-select-round-corners");this.instance.data("selectmenu").newelement.addClass("jfpw-select-round-corners")}c.css({"float":"left"});this.scrollContainer=$jq("<div/>").uid("scroll-c").css({"float":"right",position:"relative","background-color":"#ffffff"});var b=this;this.containerFooter=$jq("<div/>").uid("c-footer").addClass("round-corners-cont");this.containerFooter1=$jq("<div/>").uid("c-footerl").addClass("round-corners-l");this.containerFooter2=$jq("<div/>").uid("c-footerc").addClass("round-corners-c");this.containerFooter3=$jq("<div/>").uid("c-footerr").addClass("round-corners-r");this.containerFooter.append(this.containerFooter1);this.containerFooter.append(this.containerFooter2);this.containerFooter.append(this.containerFooter3);this.bigContainer.append(this.scrollContainer);this.bigContainer.append(this.containerFooter);var e="#"+c.attr("id");var d=$jq("<div />").uid().appendTo(this.scrollContainer);var a="#"+d.attr("id");this.listHandleSelector=a;$jq(a).jfpwidget(new CJW.jfp.widget.AutoSlider({wrapperSet:a},{range:"max",value:100,step:1,orientation:"vertical",handle:a,styleClass:"jfpw-slider",parent:e},{}));this.bigContainer.css("visibility","hidden");this.bigContainer.css("display","none");this.instance.data("selectmenu")._refreshPosition();$jq(document).bind("mousedown",function(g){var f=b.list.parent();var h=true;f.find("*").each(function(){if(g.target==$jq(this).get(0)){h=false}});if(h){$jq(b.selector).jfpwidget("widget").close(g)}});this.ready=true},destroy:function(){if(this.ready==false){return}this._destroy$();this.bigContainerPos=false;this.instance.selectmenu("destroy");this.bigContainer.remove();this.scrollContainer.remove();this.instance=null;this.ready=false},disable:function(){if(this.ready==false){return}$jq(this.selector).first().selectmenu("disable")},enable:function(){if(this.ready==false){return}$jq(this.selector).first().selectmenu("enable")},widget:function(){if(this.ready==false){return}return this.instance.data("selectmenu")},value:function(){if(this.ready==false){return}return this.instance.selectmenu("value")},render:function(a){if(this.instance==null){return}if(!a){this.refresh()}else{this._renderData(a)}},_renderData:function(a){if(this.instance==null){return}if(this.templateId=="defaultTemplate"){this._addDefTmplData(a)}else{this._addCustomTmplData(a)}this.refresh()},_addDefTmplData:function(g){var f=[];$jq.each(g.items,function(d,e){f.push({value:e.value,text:e.text})});var c=this.selector+" option";var b="";for(var a=0;a<f.length;a++){b+='<option value="'+f[a].value+'">'+f[a].text+"</option>"}$jq(c).detach();this.instance.append(b)},_addCustomTmplData:function(h){var g=[];var a=this.templateId;$jq.each(h.items,function(e,k){var j=$jq.tmpl(a,[k]);var d=$jq("<div>").append(j.clone()).remove().html();g.push({innerHTML:d})});var f=this.selector+" option";var c="";for(var b=0;b<g.length;b++){c+=g[b].innerHTML}$jq(f).detach();this.instance.append(c)}});window.$RDY&&$RDY.complete("CJW.jfp.widget.Select");